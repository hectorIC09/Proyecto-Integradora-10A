<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Dashboard</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <div class="container">
  <h1 id="welcome">Bienvenido</h1>
  <button id="btn-logout">Cerrar sesión</button>

  <script>
    async function loadUser() {
      const res = await fetch("/api/me");
      if (res.ok) {
        const d = await res.json();
        if (d.ok) {
          document.querySelector("#welcome").textContent = `Bienvenido, ${d.user.name}`;
        }
      } else {
        window.location.href = "/";
      }
    }

    document.querySelector("#btn-logout").addEventListener("click", async () => {
      const res = await fetch("/api/logout", { method: "POST" });
      const d = await res.json();
      if (d.ok) window.location.href = "/";
    });

    loadUser();

     if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker
        .register("./serviceWorker.js") 
        .then((reg) => console.log("✅ Service Worker registrado:", reg.scope))
        .catch((err) => console.error("❌ Error al registrar Service Worker:", err));
    });
  }
  </script>
  </div>
</body>
</html>
